---
import type { GetStaticPaths } from "astro";
// Astro assets
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

// components
import PostCard from "@/components/ui/PostCard.astro";
import Layout from "@/layouts/Layout.astro";

import me from "@/assets/avatar.jpg";
import Link from "../../components/ui/Link.astro";
import Heading from "@/components/ui/Heading.astro";


export const getStaticPaths = (async ({ paginate }) => {
  const allPosts = await getCollection("posts", ({ data }) => !data.isDraft);
  // most recent is sorted first
  return paginate(allPosts.sort((b, a) => new Date(b.data.pubDate).getUTCDate() - new Date(a.data.pubDate).getUTCDate()
  ), 
  { pageSize: 3 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<Layout title=`Bloggy Thoughts | Page ${page.currentPage}`>
  <main class="content-grid blog">
    <article class="wrapper flow">
      <Heading tagName="h1" size="h1" align="center">My Blog</Heading>
      <div class="switcher">
        <div>
          <h2 class="text-primary">
            Blog.
          </h2>
          <p>Page {page.currentPage}</p>
            <Image class="avatar" src={me} width={120} format="avif" alt="Profile image for Peter Chapman" />

        </div>
        <div class="grid-wrapper">
          <!-- <h3>Add something interesting to this subhead.</h3> -->
          {
            page.data.map((post) => (
              <PostCard post={post} />
            ))
          }
        </div>
        <div class="pagination">
          {
          page.url.prev &&
            <Link href={page.url.prev} variant="badge">Previous</Link>
          }
          {
          page.url.next &&
            <Link href={page.url.next} variant="badge">Next</Link>
          }
        </div>
      </div>
    </article>
  </main>
</Layout>

<style>
  .grid-wrapper {
    display: grid;
    gap: var(--size-5);
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    margin: var(--space-lg) var(--space-3xs);
  }
  .avatar {
    border: var(--border-size-3) solid var(--yellow-2);
    border-radius: var(--radius-round);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .pagination {
    margin: var(--space-lg) var(--space-3xs);
  }

</style>